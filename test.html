<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FarkÄ±ndalÄ±k Testi | KontrolSende</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- ğŸ”¹ Navigasyon -->
  <nav class="container-fluid glass-nav">
    <ul>
      <li><strong>KontrolSende</strong></li>
    </ul>
    <ul>
      <li><a href="index.html">Ana Sayfa</a></li>
      <li><a href="test.html" class="active">Test</a></li>
      <li><a href="etkinlikler.html">Etkinlikler</a></li>
      <li><a href="yardim.html">YardÄ±m</a></li>
      <li><a href="admin.html" role="button">Admin</a></li>
    </ul>
  </nav>

  <main class="container">
    <section>
      <hgroup>
        <h2>BaÄŸÄ±mlÄ±lÄ±k FarkÄ±ndalÄ±k Testi</h2>
        <h3>Kendini test et, farkÄ±ndalÄ±ÄŸÄ±nÄ± Ã¶lÃ§!</h3>
      </hgroup>

      <form id="testForm">
        <article>
          <h3>Sigara</h3>
          <label>1. GÃ¼nde ne sÄ±klÄ±kla sigara iÃ§iyorsun?
            <select required>
              <option value="0">HiÃ§</option>
              <option value="1">Ara sÄ±ra</option>
              <option value="2">SÄ±k sÄ±k</option>
              <option value="3">Her gÃ¼n</option>
            </select>
          </label>
          <label>2. SigarayÄ± bÄ±rakmayÄ± dÃ¼ÅŸÃ¼ndÃ¼n mÃ¼?
            <select required>
              <option value="3">Evet, ciddi ÅŸekilde</option>
              <option value="2">Ara sÄ±ra</option>
              <option value="1">HayÄ±r</option>
              <option value="0">HiÃ§ dÃ¼ÅŸÃ¼nmedim</option>
            </select>
          </label>
          <label>3. Sigara seni rahatlattÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yor musun?
            <select required>
              <option value="3">HayÄ±r, zararlÄ±</option>
              <option value="2">Emin deÄŸilim</option>
              <option value="1">Bazen</option>
              <option value="0">Evet</option>
            </select>
          </label>
        </article>

        <article>
          <h3>Alkol</h3>
          <label>1. Sosyal ortamlarda alkol tÃ¼ketiyor musun?
            <select required>
              <option value="0">HayÄ±r</option>
              <option value="1">Nadiren</option>
              <option value="2">SÄ±k sÄ±k</option>
              <option value="3">Her zaman</option>
            </select>
          </label>
          <label>2. Alkol seni rahatlatÄ±yor mu?
            <select required>
              <option value="3">HayÄ±r, zararlÄ±</option>
              <option value="2">Emin deÄŸilim</option>
              <option value="1">Bazen</option>
              <option value="0">Evet</option>
            </select>
          </label>
          <label>3. AlkolsÃ¼z eÄŸlenemeyeceÄŸini dÃ¼ÅŸÃ¼nÃ¼yor musun?
            <select required>
              <option value="3">HayÄ±r</option>
              <option value="2">Emin deÄŸilim</option>
              <option value="1">Bazen</option>
              <option value="0">Evet</option>
            </select>
          </label>
        </article>

        <article>
          <h3>Dijital</h3>
          <label>1. GÃ¼nÃ¼n bÃ¼yÃ¼k kÄ±smÄ±nÄ± telefonda geÃ§iriyor musun?
            <select required>
              <option value="0">Evet</option>
              <option value="1">Ara sÄ±ra</option>
              <option value="2">Nadiren</option>
              <option value="3">HayÄ±r</option>
            </select>
          </label>
          <label>2. Sosyal medyada zaman kaybettiÄŸini hissediyor musun?
            <select required>
              <option value="3">Evet</option>
              <option value="2">Bazen</option>
              <option value="1">Nadiren</option>
              <option value="0">HayÄ±r</option>
            </select>
          </label>
          <label>3. CihazÄ±nÄ± yanÄ±nda bulundurmazsan huzursuz olur musun?
            <select required>
              <option value="0">Evet</option>
              <option value="1">Bazen</option>
              <option value="2">Nadiren</option>
              <option value="3">HayÄ±r</option>
            </select>
          </label>
        </article>

        <button type="submit">SonuÃ§larÄ± GÃ¶r</button>
      </form>

      <div id="resultSection" style="display:none; margin-top:2rem;">
        <h3>Sonucun:</h3>
        <p id="totalResult"></p>
      </div>
    </section>
  </main>

  <footer class="container">
    <small>
      <a href="index.html">KontrolSende</a> â€¢ 
      <a href="https://unsplash.com" target="_blank">GÃ¶rseller: Unsplash</a>
    </small>
  </footer>

  <script src="js/main.js"></script>
  <script>
    const form = document.getElementById("testForm");
    const resultDiv = document.getElementById("resultSection");
    const totalResult = document.getElementById("totalResult");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const selects = form.querySelectorAll("select");
      const values = Array.from(selects).map(s => parseInt(s.value));

      // Kategorilere gÃ¶re bÃ¶l
      const cats = ["Sigara", "Alkol", "Dijital"];
      const catScores = [
        average(values.slice(0, 3)) * 100 / 3,
        average(values.slice(3, 6)) * 100 / 3,
        average(values.slice(6, 9)) * 100 / 3
      ];

      const total = Math.round(average(catScores));

      totalResult.innerHTML = `
        Genel farkÄ±ndalÄ±k oranÄ±: <strong>${total}%</strong><br><br>
        Sigara: ${catScores[0].toFixed(0)}% â€¢ 
        Alkol: ${catScores[1].toFixed(0)}% â€¢ 
        Dijital: ${catScores[2].toFixed(0)}%
      `;
      resultDiv.style.display = "block";

      // API'ye kaydet
      const resultData = {
        total_pct: total,
        cats: cats.map((c, i) => ({ cat: c, pct: catScores[i] }))
      };
      await saveTestResult(resultData);
    });
  </script>
</body>
</html>
